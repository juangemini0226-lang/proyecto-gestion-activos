<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Escaner de Código QR</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/pulse/bootstrap.min.css">
    <style>
        body {display:flex; align-items:center; justify-content:center; min-height:100vh; background-color:#f8f9fa;}
        .card {max-width:500px; width:100%;}
    </style>
</head>
<body>
    {% if messages %}
    <div class="container position-fixed top-0 start-0 end-0 mt-3" style="z-index:1000;">
        {% for message in messages %}
        <div class="alert alert-warning alert-dismissible fade show mx-auto" role="alert" style="max-width:500px;">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <div class="card shadow-sm">
        <div class="card-body text-center">
            <h4 class="card-title mb-3">Escanear Código QR</h4>
            <div id="qr-reader" class="mb-3"></div>
            <p class="mb-2">Buscar por código o # activo</p>
            <div class="input-group mb-3">
                <input type="text" id="manual-code" class="form-control" placeholder="Ej. MOL10598 o 10598">
                <button id="manual-btn" class="btn btn-primary">Buscar</button>
            </div>
            <div id="qr-reader-results"></div>
        </div>
    </div>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script>
        function goTo(code){
            window.location.href = `/activos/buscar/${code}/`;
        }
        function onScanSuccess(decodedText, decodedResult){
            goTo(decodedText);
        }
        var html5QrcodeScanner = new Html5QrcodeScanner("qr-reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
        document.getElementById('manual-btn').addEventListener('click', function(){
            const code = document.getElementById('manual-code').value.trim();
            if(code){ goTo(code); }
        });
    </script>
</body>
</html>
